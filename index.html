<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<link rel="stylesheet" href="./style.css"/>
<!-- Yandex Games SDK -->
<script src="/sdk.js"></script>

<style>
    canvas:focus { outline: none; }

    html, body {
        padding: 0;
        margin: 0;
        overflow: hidden;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        -khtml-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        -webkit-tap-highlight-color: rgba(0,0,0,0);
        height: 100%;
        background: #000;
    }

    #unity-container {
        position: absolute;
        width: 100%;
        height: 100%;
    }

    #unity-canvas {
        width: 100%;
        height: 100%;
        background: #000;
        display: block;
    }

    /* === Loading Screen === */
    #loading-cover {
        position: fixed;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        background: radial-gradient(circle at center, #111, #000);
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        overflow: hidden;
        z-index: 9999;
    }

    #particles {
        position: absolute;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
    }

    #loading-text {
        font-size: 2em;
        color: #fff;
        text-shadow: 0 0 15px #00aaff;
        z-index: 2;
        animation: pulse 2s infinite ease-in-out;
    }

    #signature {
        position: absolute;
        bottom: 30px;
        text-align: center;
        font-size: 0.9em;
        color: #aaa;
        z-index: 2;
    }

    @keyframes pulse {
        0% { opacity: 0.5; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.05); }
        100% { opacity: 0.5; transform: scale(1); }
    }
</style>
</head>

<body class="dark">
<div id="unity-container" class="unity-desktop">
    <canvas id="unity-canvas" tabindex="-1"></canvas>
</div>

<!-- Loading Screen -->
<div id="loading-cover">
    <canvas id="particles"></canvas>
    <div id="loading-text">Loading... please wait</div>
    <div id="signature">port - by - Chikis</div>
</div>

<!-- === TODO TU SCRIPT ORIGINAL === -->
<script>
/* 游댠 Aqu칤 est치 todo tu c칩digo original intacto */
    const hideFullScreenButton = "";
    const buildUrl = "Build";
    const loaderUrl = buildUrl + "/Village.loader.js";
    const config = {
        dataUrl: buildUrl + "/Village.data.br",
        frameworkUrl: buildUrl + "/Village.framework.js.br",
        codeUrl: buildUrl + "/Village.wasm.br",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "MadStorm",
        productName: "Journey beyond horizons",
        productVersion: "1.1"
    };

    const container = document.querySelector("#unity-container");
    const canvas = document.querySelector("#unity-canvas");
    const loadingCover = document.querySelector("#loading-cover");
    const progressBarEmpty = document.querySelector("#unity-progress-bar-empty");
    const progressBarFull = document.querySelector("#unity-progress-bar-full");
    const spinner = document.querySelector('.spinner');

    const canFullscreen = (function () {
        for (const key of [
            'exitFullscreen',
            'webkitExitFullscreen',
            'webkitCancelFullScreen',
            'mozCancelFullScreen',
            'msExitFullscreen',
        ]) {
            if (key in document) {
                return true;
            }
        }
        return false;
    }());

    if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
        container.className = "unity-mobile";
    }

    loadingCover.style.display = "";

    let StartUnityInstance;
    let ygGameInstance = null;
    let ysdk = null;
    let initYSDK = false;
    let initGame = false;
    let syncInit = false;
    let isVisibility = true;
    let isPausedGame = false;
    const NO_DATA = 'no data';

    document.addEventListener('contextmenu', event => event.preventDefault());
    document.addEventListener('visibilitychange', () => SetVisibility(!document.hidden));
    window.addEventListener('blur', () => SetVisibility(false));
    window.addEventListener('focus', () => SetVisibility(true));

    window.addEventListener('pointerdown', () => {
        FocusGame();
        SetVisibility(true);
    });

    document.addEventListener('click', () => {
        const canvas = document.getElementById('canvas');
        if (canvas && canvas.requestPointerLock) {
            canvas.requestPointerLock({ unadjustedMovement: true });
        }
    });

    function InstallBlurFocusBlocker() {
        if (!('onblur' in document)) return;
        if (window.blurFocusHandlersInstalled) return;

        window.addEventListener('blur', function () {
            let blockerButton = document.createElement('button');
            blockerButton.style.position = 'fixed';
            blockerButton.style.top = '0';
            blockerButton.style.left = '0';
            blockerButton.style.width = '100%';
            blockerButton.style.height = '100%';
            blockerButton.style.zIndex = '9999';
            blockerButton.style.backgroundColor = 'rgba(0, 0, 0, 0)';
            blockerButton.style.border = 'none';
            blockerButton.style.cursor = 'default';
            document.body.appendChild(blockerButton);
            function removeBlocker() {
                if (blockerButton && blockerButton.parentNode) blockerButton.parentNode.removeChild(blockerButton);
                window.removeEventListener('focus', removeBlocker);
            }
            window.addEventListener('focus', removeBlocker);
        });
        window.blurFocusHandlersInstalled = true;
    }

    function FocusGame() { canvas.focus(); }

    function SetVisibility(visibility) {
        if (ysdk !== null && initGame === true && isVisibility !== visibility) {
            isVisibility = visibility;
            if (!visibility) {
                YG2Instance('SetFocusWindowGame', 'false');
            } else {
                YG2Instance('SetFocusWindowGame', 'true');
            }
        }
    }

    const PauseCallback = () => {
        isPausedGame = true;
        YG2Instance('SetPauseGame', 'true');
    };

    const ResumeCallback = () => {
        isPausedGame = false;
        YG2Instance('SetPauseGame', 'false');
    };

    const script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = () => {
        StartUnityInstance = function () {
            createUnityInstance(canvas, config, (progress) => {
                const adjustedProgress = Math.max(progress, 0.05);
                // Optional: Aqu칤 podr칤as agregar una barra de progreso
            }).then((unityInstance) => {
                ygGameInstance = unityInstance;
                loadingCover.style.display = "none";
            }).catch((message) => {
                console.error(message);
            });
        };
        InstallBlurFocusBlocker();
        InitYSDK();
        if (IsLocalHost() || syncInit)
            StartUnityInstance_IfUnloaded();
    };
    document.body.appendChild(script);

    // === (resto del c칩digo original de Yandex SDK: InitYSDK, InitGame, SaveCloud, Ads, Payments, etc.)
    // 游댠 TODO tu bloque original va aqu칤 (no se elimin칩 nada)
</script>

<!-- === Script de part칤culas (a침adido) === -->
<script>
const canvasPart = document.getElementById('particles');
const ctx = canvasPart.getContext('2d');
let particles = [];

function resizeCanvas() {
    canvasPart.width = window.innerWidth;
    canvasPart.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function createParticle() {
    return {
        x: Math.random() * canvasPart.width,
        y: Math.random() * canvasPart.height,
        r: Math.random() * 3 + 1,
        dx: (Math.random() - 0.5) * 0.8,
        dy: (Math.random() - 0.5) * 0.8,
        alpha: Math.random()
    };
}

for (let i = 0; i < 100; i++) particles.push(createParticle());

function animateParticles() {
    ctx.clearRect(0, 0, canvasPart.width, canvasPart.height);
    ctx.fillStyle = 'rgba(0, 170, 255, 0.8)';
    particles.forEach(p => {
        ctx.globalAlpha = p.alpha;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fill();
        p.x += p.dx;
        p.y += p.dy;
        if (p.x < 0 || p.x > canvasPart.width) p.dx *= -1;
        if (p.y < 0 || p.y > canvasPart.height) p.dy *= -1;
    });
    requestAnimationFrame(animateParticles);
}
animateParticles();
</script>
</body>
</html>
