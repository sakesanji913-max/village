<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8"/>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
<link rel="stylesheet" href="./style.css"/>
<script src="/sdk.js"></script>
</head>

<body class="dark">
<div id="unity-container" class="unity-desktop">
    <!-- ✅ Fixed only this: changed id -->
    <canvas id="canvas" tabindex="-1"></canvas>
</div>

<div id="loading-cover">
    <canvas id="particles"></canvas>
    <div id="loading-text">Loading... please wait</div>
    <div id="signature">port - by - Chikis</div>
</div>

<script>
const hideFullScreenButton = "";
const buildUrl = "Build";
const loaderUrl = buildUrl + "/Village.loader.js";
const config = {
    dataUrl: buildUrl + "/Village.data.br",
    frameworkUrl: buildUrl + "/Village.framework.js.br",
    codeUrl: buildUrl + "/Village.wasm.br",
    streamingAssetsUrl: "StreamingAssets",
    companyName: "MadStorm",
    productName: "Journey beyond horizons",
    productVersion: "1.1"
};

const container = document.querySelector("#unity-container");
const canvas = document.querySelector("#canvas"); // ✅ fixed reference
const loadingCover = document.querySelector("#loading-cover");

const script = document.createElement("script");
script.src = loaderUrl;
script.onload = () => {
    createUnityInstance(canvas, config, (progress) => {}).then((unityInstance) => {
        loadingCover.style.display = "none";
    }).catch((message) => {
        console.error(message);
    });
};
document.body.appendChild(script);
</script>

<script>
const canvasPart = document.getElementById('particles');
const ctx = canvasPart.getContext('2d');
let particles = [];

function resizeCanvas() {
    canvasPart.width = window.innerWidth;
    canvasPart.height = window.innerHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

function createParticle() {
    return {
        x: Math.random() * canvasPart.width,
        y: Math.random() * canvasPart.height,
        r: Math.random() * 3 + 1,
        dx: (Math.random() - 0.5) * 0.8,
        dy: (Math.random() - 0.5) * 0.8,
        alpha: Math.random()
    };
}

for (let i = 0; i < 100; i++) particles.push(createParticle());

function animateParticles() {
    ctx.clearRect(0, 0, canvasPart.width, canvasPart.height);
    ctx.fillStyle = 'rgba(0, 170, 255, 0.8)';
    particles.forEach(p => {
        ctx.globalAlpha = p.alpha;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        ctx.fill();
        p.x += p.dx;
        p.y += p.dy;
        if (p.x < 0 || p.x > canvasPart.width) p.dx *= -1;
        if (p.y < 0 || p.y > canvasPart.height) p.dy *= -1;
    });
    requestAnimationFrame(animateParticles);
}
animateParticles();
</script>
</body>
</html>
